// We are going to skimp a bit on these tests...

import { assert, expect } from "chai";
import { network, deployments, ethers } from "hardhat";
import { developmentChains } from "../../helper-hardhat-config";
import { DynamicSvgNFT, MockV3Aggregator } from "../../typechain-types";

const lowSVGImageuri =
	"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEyIDMuNTM4NDZDNy4zMjY4MiAzLjUzODQ2IDMuNTM4NDYgNy4zMjY4MiAzLjUzODQ2IDEyQzMuNTM4NDYgMTYuNjczMiA3LjMyNjgyIDIwLjQ2MTUgMTIgMjAuNDYxNUMxNi42NzMyIDIwLjQ2MTUgMjAuNDYxNSAxNi42NzMyIDIwLjQ2MTUgMTJDMjAuNDYxNSA3LjMyNjgyIDE2LjY3MzIgMy41Mzg0NiAxMiAzLjUzODQ2Wk0yIDEyQzIgNi40NzcxNSA2LjQ3NzE1IDIgMTIgMkMxNy41MjI4IDIgMjIgNi40NzcxNSAyMiAxMkMyMiAxNy41MjI4IDE3LjUyMjggMjIgMTIgMjJDNi40NzcxNSAyMiAyIDE3LjUyMjggMiAxMloiIGZpbGw9IiMwMzBENDUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS4wNzY5IDE1Ljg0NjJDMTUuNTAxOCAxNS44NDYyIDE1Ljg0NjIgMTUuNTAxOCAxNS44NDYyIDE1LjA3NjlDMTUuODQ2MiAxNC42NTIxIDE1LjUwMTggMTQuMzA3NyAxNS4wNzY5IDE0LjMwNzdIOC45MjMwOEM4LjQ5ODI0IDE0LjMwNzcgOC4xNTM4NSAxNC42NTIxIDguMTUzODUgMTUuMDc2OUM4LjE1Mzg1IDE1LjUwMTggOC40OTgyNCAxNS44NDYyIDguOTIzMDggMTUuODQ2MkgxNS4wNzY5WiIgZmlsbD0iIzAzMEQ0NSIvPgo8cGF0aCBkPSJNOS45NDg3MiA4LjkyMzA4QzkuOTQ4NzIgOS40ODk1MiA5LjQ4OTUyIDkuOTQ4NzIgOC45MjMwOCA5Ljk0ODcyQzguMzU2NjMgOS45NDg3MiA3Ljg5NzQ0IDkuNDg5NTIgNy44OTc0NCA4LjkyMzA4QzcuODk3NDQgOC4zNTY2MyA4LjM1NjYzIDcuODk3NDQgOC45MjMwOCA3Ljg5NzQ0QzkuNDg5NTIgNy44OTc0NCA5Ljk0ODcyIDguMzU2NjMgOS45NDg3MiA4LjkyMzA4WiIgZmlsbD0iIzAzMEQ0NSIvPgo8cGF0aCBkPSJNMTYuMTAyNiA4LjkyMzA4QzE2LjEwMjYgOS40ODk1MiAxNS42NDM0IDkuOTQ4NzIgMTUuMDc2OSA5Ljk0ODcyQzE0LjUxMDUgOS45NDg3MiAxNC4wNTEzIDkuNDg5NTIgMTQuMDUxMyA4LjkyMzA4QzE0LjA1MTMgOC4zNTY2MyAxNC41MTA1IDcuODk3NDQgMTUuMDc2OSA3Ljg5NzQ0QzE1LjY0MzQgNy44OTc0NCAxNi4xMDI2IDguMzU2NjMgMTYuMTAyNiA4LjkyMzA4WiIgZmlsbD0iIzAzMEQ0NSIvPgo8L3N2Zz4=";
const highSVGimageUri =
	"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBVcGxvYWRlZCB0bzogU1ZHIFJlcG8sIHd3dy5zdmdyZXBvLmNvbSwgR2VuZXJhdG9yOiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4NCjxzdmcgZmlsbD0iIzAwMDAwMCIgaGVpZ2h0PSI4MDBweCIgd2lkdGg9IjgwMHB4IiB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiANCgkgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQoJPGc+DQoJCTxwYXRoIGQ9Ik0yNTYsMEMxMTQuODQzLDAsMCwxMTQuODQzLDAsMjU2YzAsMTQxLjE1NywxMTQuODQzLDI1NiwyNTYsMjU2czI1Ni0xMTQuODQzLDI1Ni0yNTZDNTEyLDExNC44NDMsMzk3LjE1NywwLDI1Niwweg0KCQkJIE0yNTYsNDkzLjAzN0MxMjUuMjk2LDQ5My4wMzcsMTguOTYzLDM4Ni43MDQsMTguOTYzLDI1NkMxOC45NjMsMTI1LjI5NiwxMjUuMjk2LDE4Ljk2MywyNTYsMTguOTYzUzQ5My4wMzcsMTI1LjI5Niw0OTMuMDM3LDI1Ng0KCQkJQzQ5My4wMzcsMzg2LjcwNCwzODYuNzA0LDQ5My4wMzcsMjU2LDQ5My4wMzd6Ii8+DQoJPC9nPg0KPC9nPg0KPGc+DQoJPGc+DQoJCTxwYXRoIGQ9Ik00MTcuMTg1LDI0Ni41MThjLTUuMjM2LDAtOS40ODEsNC4yNDYtOS40ODEsOS40ODJjMCw4My42NDgtNjguMDU2LDE1MS43MDQtMTUxLjcwNCwxNTEuNzA0UzEwNC4yOTYsMzM5LjY0OCwxMDQuMjk2LDI1Ng0KCQkJYzAtNS4yMzYtNC4yNDUtOS40ODItOS40ODItOS40ODJzLTkuNDgyLDQuMjQ2LTkuNDgyLDkuNDgyYzAsOTQuMTA3LDc2LjU2LDE3MC42NjcsMTcwLjY2NywxNzAuNjY3UzQyNi42NjcsMzUwLjEwNyw0MjYuNjY3LDI1Ng0KCQkJQzQyNi42NjcsMjUwLjc2NCw0MjIuNDIxLDI0Ni41MTgsNDE3LjE4NSwyNDYuNTE4eiIvPg0KCTwvZz4NCjwvZz4NCjxnPg0KCTxnPg0KCQk8cGF0aCBkPSJNMTgwLjE0OCwxNjEuMTg1Yy01LjIzNiwwLTkuNDgxLDQuMjQ2LTkuNDgxLDkuNDgydjU2Ljg4OWMwLDUuMjM2LDQuMjQ1LDkuNDgyLDkuNDgxLDkuNDgyczkuNDgyLTQuMjQ1LDkuNDgyLTkuNDgyDQoJCQl2LTU2Ljg4OUMxODkuNjMsMTY1LjQzMSwxODUuMzg0LDE2MS4xODUsMTgwLjE0OCwxNjEuMTg1eiIvPg0KCTwvZz4NCjwvZz4NCjxnPg0KCTxnPg0KCQk8cGF0aCBkPSJNMzMxLjg1MiwxNjEuMTg1Yy01LjIzNiwwLTkuNDgyLDQuMjQ2LTkuNDgyLDkuNDgydjU2Ljg4OWMwLDUuMjM2LDQuMjQ1LDkuNDgyLDkuNDgyLDkuNDgyczkuNDgxLTQuMjQ1LDkuNDgxLTkuNDgyDQoJCQl2LTU2Ljg4OUMzNDEuMzMzLDE2NS40MzEsMzM3LjA4OCwxNjEuMTg1LDMzMS44NTIsMTYxLjE4NXoiLz4NCgk8L2c+DQo8L2c+DQo8L3N2Zz4=";
const highTokenUri =
	"data:application/json;base64,eyJuYW1lIjoiRHluYW1pYyBTVkcgTkZUIiwgImRlc2NyaXB0aW9uIjoiQW4gTkZUIHRoYXQgY2hhbmdlcyBiYXNlZCBvbiBDaGFpbkxpbmsgRmVlZCIsICJhdHRyaWJ1dGVzIjpbeyJ0cmFpdF90eXBlOiJjb29sbmVzcyIsInZhbHVlIjoxMDB9XSwgImltYWdlIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpYVhOdkxUZzROVGt0TVNJL1BnMEtQQ0V0TFNCVmNHeHZZV1JsWkNCMGJ6b2dVMVpISUZKbGNHOHNJSGQzZHk1emRtZHlaWEJ2TG1OdmJTd2dSMlZ1WlhKaGRHOXlPaUJUVmtjZ1VtVndieUJOYVhobGNpQlViMjlzY3lBdExUNE5Danh6ZG1jZ1ptbHNiRDBpSXpBd01EQXdNQ0lnYUdWcFoyaDBQU0k0TURCd2VDSWdkMmxrZEdnOUlqZ3dNSEI0SWlCMlpYSnphVzl1UFNJeExqRWlJR2xrUFNKTVlYbGxjbDh4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJaUFOQ2drZ2RtbGxkMEp2ZUQwaU1DQXdJRFV4TWlBMU1USWlJSGh0YkRwemNHRmpaVDBpY0hKbGMyVnlkbVVpUGcwS1BHYytEUW9KUEdjK0RRb0pDVHh3WVhSb0lHUTlJazB5TlRZc01FTXhNVFF1T0RRekxEQXNNQ3d4TVRRdU9EUXpMREFzTWpVMll6QXNNVFF4TGpFMU55d3hNVFF1T0RRekxESTFOaXd5TlRZc01qVTJjekkxTmkweE1UUXVPRFF6TERJMU5pMHlOVFpETlRFeUxERXhOQzQ0TkRNc016azNMakUxTnl3d0xESTFOaXd3ZWcwS0NRa0pJRTB5TlRZc05Ea3pMakF6TjBNeE1qVXVNamsyTERRNU15NHdNemNzTVRndU9UWXpMRE00Tmk0M01EUXNNVGd1T1RZekxESTFOa014T0M0NU5qTXNNVEkxTGpJNU5pd3hNalV1TWprMkxERTRMamsyTXl3eU5UWXNNVGd1T1RZelV6UTVNeTR3TXpjc01USTFMakk1Tml3ME9UTXVNRE0zTERJMU5nMEtDUWtKUXpRNU15NHdNemNzTXpnMkxqY3dOQ3d6T0RZdU56QTBMRFE1TXk0d016Y3NNalUyTERRNU15NHdNemQ2SWk4K0RRb0pQQzluUGcwS1BDOW5QZzBLUEdjK0RRb0pQR2MrRFFvSkNUeHdZWFJvSUdROUlrMDBNVGN1TVRnMUxESTBOaTQxTVRoakxUVXVNak0yTERBdE9TNDBPREVzTkM0eU5EWXRPUzQwT0RFc09TNDBPREpqTUN3NE15NDJORGd0TmpndU1EVTJMREUxTVM0M01EUXRNVFV4TGpjd05Dd3hOVEV1TnpBMFV6RXdOQzR5T1RZc016TTVMalkwT0N3eE1EUXVNamsyTERJMU5nMEtDUWtKWXpBdE5TNHlNell0TkM0eU5EVXRPUzQwT0RJdE9TNDBPREl0T1M0ME9ESnpMVGt1TkRneUxEUXVNalEyTFRrdU5EZ3lMRGt1TkRneVl6QXNPVFF1TVRBM0xEYzJMalUyTERFM01DNDJOamNzTVRjd0xqWTJOeXd4TnpBdU5qWTNVelF5Tmk0Mk5qY3NNelV3TGpFd055dzBNall1TmpZM0xESTFOZzBLQ1FrSlF6UXlOaTQyTmpjc01qVXdMamMyTkN3ME1qSXVOREl4TERJME5pNDFNVGdzTkRFM0xqRTROU3d5TkRZdU5URTRlaUl2UGcwS0NUd3ZaejROQ2p3dlp6NE5DanhuUGcwS0NUeG5QZzBLQ1FrOGNHRjBhQ0JrUFNKTk1UZ3dMakUwT0N3eE5qRXVNVGcxWXkwMUxqSXpOaXd3TFRrdU5EZ3hMRFF1TWpRMkxUa3VORGd4TERrdU5EZ3lkalUyTGpnNE9XTXdMRFV1TWpNMkxEUXVNalExTERrdU5EZ3lMRGt1TkRneExEa3VORGd5Y3prdU5EZ3lMVFF1TWpRMUxEa3VORGd5TFRrdU5EZ3lEUW9KQ1FsMkxUVTJMamc0T1VNeE9Ea3VOak1zTVRZMUxqUXpNU3d4T0RVdU16ZzBMREUyTVM0eE9EVXNNVGd3TGpFME9Dd3hOakV1TVRnMWVpSXZQZzBLQ1R3dlp6NE5Dand2Wno0TkNqeG5QZzBLQ1R4blBnMEtDUWs4Y0dGMGFDQmtQU0pOTXpNeExqZzFNaXd4TmpFdU1UZzFZeTAxTGpJek5pd3dMVGt1TkRneUxEUXVNalEyTFRrdU5EZ3lMRGt1TkRneWRqVTJMamc0T1dNd0xEVXVNak0yTERRdU1qUTFMRGt1TkRneUxEa3VORGd5TERrdU5EZ3ljemt1TkRneExUUXVNalExTERrdU5EZ3hMVGt1TkRneURRb0pDUWwyTFRVMkxqZzRPVU16TkRFdU16TXpMREUyTlM0ME16RXNNek0zTGpBNE9Dd3hOakV1TVRnMUxETXpNUzQ0TlRJc01UWXhMakU0TlhvaUx6NE5DZ2s4TDJjK0RRbzhMMmMrRFFvOEwzTjJaejQ9In0=";
const lowTokenUri =
	"data:application/json;base64,eyJuYW1lIjoiRHluYW1pYyBTVkcgTkZUIiwgImRlc2NyaXB0aW9uIjoiQW4gTkZUIHRoYXQgY2hhbmdlcyBiYXNlZCBvbiBDaGFpbkxpbmsgRmVlZCIsICJhdHRyaWJ1dGVzIjpbeyJ0cmFpdF90eXBlOiJjb29sbmVzcyIsInZhbHVlIjoxMDB9XSwgImltYWdlIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejQ4SVMwdElGVndiRzloWkdWa0lIUnZPaUJUVmtjZ1VtVndieXdnZDNkM0xuTjJaM0psY0c4dVkyOXRMQ0JIWlc1bGNtRjBiM0k2SUZOV1J5QlNaWEJ2SUUxcGVHVnlJRlJ2YjJ4eklDMHRQZ284YzNabklIZHBaSFJvUFNJNE1EQndlQ0lnYUdWcFoyaDBQU0k0TURCd2VDSWdkbWxsZDBKdmVEMGlNQ0F3SURJMElESTBJaUJtYVd4c1BTSnViMjVsSWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGdvOGNHRjBhQ0JtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpSUdOc2FYQXRjblZzWlQwaVpYWmxibTlrWkNJZ1pEMGlUVEV5SURNdU5UTTRORFpETnk0ek1qWTRNaUF6TGpVek9EUTJJRE11TlRNNE5EWWdOeTR6TWpZNE1pQXpMalV6T0RRMklERXlRek11TlRNNE5EWWdNVFl1Tmpjek1pQTNMak15TmpneUlESXdMalEyTVRVZ01USWdNakF1TkRZeE5VTXhOaTQyTnpNeUlESXdMalEyTVRVZ01qQXVORFl4TlNBeE5pNDJOek15SURJd0xqUTJNVFVnTVRKRE1qQXVORFl4TlNBM0xqTXlOamd5SURFMkxqWTNNeklnTXk0MU16ZzBOaUF4TWlBekxqVXpPRFEyV2sweUlERXlReklnTmk0ME56Y3hOU0EyTGpRM056RTFJRElnTVRJZ01rTXhOeTQxTWpJNElESWdNaklnTmk0ME56Y3hOU0F5TWlBeE1rTXlNaUF4Tnk0MU1qSTRJREUzTGpVeU1qZ2dNaklnTVRJZ01qSkROaTQwTnpjeE5TQXlNaUF5SURFM0xqVXlNamdnTWlBeE1sb2lJR1pwYkd3OUlpTXdNekJFTkRVaUx6NEtQSEJoZEdnZ1ptbHNiQzF5ZFd4bFBTSmxkbVZ1YjJSa0lpQmpiR2x3TFhKMWJHVTlJbVYyWlc1dlpHUWlJR1E5SWsweE5TNHdOelk1SURFMUxqZzBOakpETVRVdU5UQXhPQ0F4TlM0NE5EWXlJREUxTGpnME5qSWdNVFV1TlRBeE9DQXhOUzQ0TkRZeUlERTFMakEzTmpsRE1UVXVPRFEyTWlBeE5DNDJOVEl4SURFMUxqVXdNVGdnTVRRdU16QTNOeUF4TlM0d056WTVJREUwTGpNd056ZElPQzQ1TWpNd09FTTRMalE1T0RJMElERTBMak13TnpjZ09DNHhOVE00TlNBeE5DNDJOVEl4SURndU1UVXpPRFVnTVRVdU1EYzJPVU00TGpFMU16ZzFJREUxTGpVd01UZ2dPQzQwT1RneU5DQXhOUzQ0TkRZeUlEZ3VPVEl6TURnZ01UVXVPRFEyTWtneE5TNHdOelk1V2lJZ1ptbHNiRDBpSXpBek1FUTBOU0l2UGdvOGNHRjBhQ0JrUFNKTk9TNDVORGczTWlBNExqa3lNekE0UXprdU9UUTROeklnT1M0ME9EazFNaUE1TGpRNE9UVXlJRGt1T1RRNE56SWdPQzQ1TWpNd09DQTVMamswT0RjeVF6Z3VNelUyTmpNZ09TNDVORGczTWlBM0xqZzVOelEwSURrdU5EZzVOVElnTnk0NE9UYzBOQ0E0TGpreU16QTRRemN1T0RrM05EUWdPQzR6TlRZMk15QTRMak0xTmpZeklEY3VPRGszTkRRZ09DNDVNak13T0NBM0xqZzVOelEwUXprdU5EZzVOVElnTnk0NE9UYzBOQ0E1TGprME9EY3lJRGd1TXpVMk5qTWdPUzQ1TkRnM01pQTRMamt5TXpBNFdpSWdabWxzYkQwaUl6QXpNRVEwTlNJdlBnbzhjR0YwYUNCa1BTSk5NVFl1TVRBeU5pQTRMamt5TXpBNFF6RTJMakV3TWpZZ09TNDBPRGsxTWlBeE5TNDJORE0wSURrdU9UUTROeklnTVRVdU1EYzJPU0E1TGprME9EY3lRekUwTGpVeE1EVWdPUzQ1TkRnM01pQXhOQzR3TlRFeklEa3VORGc1TlRJZ01UUXVNRFV4TXlBNExqa3lNekE0UXpFMExqQTFNVE1nT0M0ek5UWTJNeUF4TkM0MU1UQTFJRGN1T0RrM05EUWdNVFV1TURjMk9TQTNMamc1TnpRMFF6RTFMalkwTXpRZ055NDRPVGMwTkNBeE5pNHhNREkySURndU16VTJOak1nTVRZdU1UQXlOaUE0TGpreU16QTRXaUlnWm1sc2JEMGlJekF6TUVRME5TSXZQZ284TDNOMlp6ND0ifQ==";

!developmentChains.includes(network.name)
	? describe.skip
	: describe("Dynamic SVG NFT Unit Tests", function () {
			let dynamicSvgNft: DynamicSvgNFT,
				deployer,
				mockV3Aggregator: MockV3Aggregator;

			beforeEach(async () => {
				const accounts = await ethers.getSigners();
				deployer = accounts[0];
				await deployments.fixture(["mocks", "dynamicsvg"]);
				dynamicSvgNft = await ethers.getContract("DynamicSvgNFT");
				mockV3Aggregator = await ethers.getContract("MockV3Aggregator");
			});

			describe("constructor", () => {
				it("sets starting values correctly", async function () {
					const lowSVG = await dynamicSvgNft.getLowSVG();
					const highSVG = await dynamicSvgNft.getHighSVG();
					const priceFeed = await dynamicSvgNft.getPriceFeed();
					assert.equal(lowSVG, lowSVGImageuri);
					assert.equal(highSVG, highSVGimageUri);
					assert.equal(priceFeed, mockV3Aggregator.address);
				});
			});

			describe("mintNft", () => {
				it("emits an event and creates the NFT", async function () {
					const highValue = ethers.utils.parseEther("1"); // 1 dollar per ether
					await expect(dynamicSvgNft.mintNFT(highValue)).to.emit(
						dynamicSvgNft,
						"CreatedNFT"
					);
					const tokenCounter = await dynamicSvgNft.getTokenCounter();
					assert.equal(tokenCounter.toString(), "1");
					const tokenURI = await dynamicSvgNft.tokenURI(0);
					assert.equal(tokenURI, highTokenUri);
				});
				it("shifts the token uri to lower when the price doesn't surpass the highvalue", async function () {
					const highValue = ethers.utils.parseEther("100000000"); // $100,000,000 dollar per ether. Maybe in the distant future this test will fail...
					const txResponse = await dynamicSvgNft.mintNFT(highValue);
					await txResponse.wait(1);
					const tokenURI = await dynamicSvgNft.tokenURI(0);
					assert.equal(tokenURI, lowTokenUri);
				});
			});
	  });
